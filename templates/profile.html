{% extends "layout.html" %}
{% block title %}–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<h2 class="mb-4 text-center">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
<div class="row justify-content-center">
  <div class="col-md-6 text-center">
    <!-- –ê–≤–∞—Ç–∞—Ä –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è –∏–∫–æ–Ω–∫–∞ -->
    {% if user.avatar_data %}
      <img
        src="{{ url_for('avatar', user_id=user.id) }}"
        class="rounded-circle mb-3"
        style="width:150px; height:150px; object-fit:cover;"
        alt="–ê–≤–∞—Ç–∞—Ä"
      >
    {% else %}
      <span
        class="rounded-circle bg-secondary text-white d-flex justify-content-center align-items-center mb-3"
        style="width:150px; height:150px; font-size:72px;"
        role="img" aria-label="–ü—Ä–æ—Ñ–∏–ª—å"
      >üë§</span>
    {% endif %}

    <!-- –§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞ -->
    <form method="POST" enctype="multipart/form-data">
      <input
        type="file"
        name="avatar"
        id="avatar"
        accept="image/*"
        hidden
        onchange="this.form.submit()"
      >
      <button
        type="button"
        class="btn btn-outline-primary"
        onclick="document.getElementById('avatar').click()"
      >–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
      <input type="hidden" name="save_profile">
    </form>

    <hr class="my-4">

    <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –§–ò–û, email, –ª–æ–≥–∏–Ω–∞ -->
    <form method="POST">
      <input type="hidden" name="save_profile">
      <div class="form-group text-left">
        <label for="full_name">–§–ò–û</label>
        <input
          type="text"
          id="full_name"
          name="full_name"
          class="form-control"
          value="{{ user.full_name or '' }}"
        >
      </div>
      <div class="form-group text-left">
        <label for="email">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          class="form-control"
          value="{{ user.email }}"
          required
        >
      </div>
      <div class="form-group text-left">
        <label for="username">–õ–æ–≥–∏–Ω</label>
        <input
          type="text"
          id="username"
          name="username"
          class="form-control"
          value="{{ user.username }}"
          required
        >
      </div>
      <button type="submit" class="btn btn-primary mt-2">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    </form>

    <hr class="my-4">

    <!-- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è -->
    <h4 class="text-left">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h4>
    <form method="POST">
      <input type="hidden" name="change_password">
      <div class="form-group text-left">
        <label for="current_password">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
        <input
          type="password"
          id="current_password"
          name="current_password"
          class="form-control"
          required
        >
      </div>
      <div class="form-group text-left">
        <label for="new_password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
        <input
          type="password"
          id="new_password"
          name="new_password"
          class="form-control"
          required
        >
      </div>
      <div class="form-group text-left">
        <label for="new_password2">–ü–æ–≤—Ç–æ—Ä –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è</label>
        <input
          type="password"
          id="new_password2"
          name="new_password2"
          class="form-control"
          required
        >
      </div>
      <button type="submit" class="btn btn-warning mt-2">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
    </form>

    <hr class="my-4">

    <!-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ -->
    <h3 class="text-left">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h3>
    {% if orders %}
      <ul class="list-group text-left">
        {% for order in orders %}
          <li class="list-group-item">
            <strong>–ó–∞–∫–∞–∑ #{{ order.id }}</strong>
            –æ—Ç {{ order.timestamp.strftime('%d.%m.%Y %H:%M') }},
            —Å—Ç–∞—Ç—É—Å: <em>{{ order.status }}</em>.
            <a href="{{ url_for('orders') }}#order-{{ order.id }}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>–£ –≤–∞—Å –µ—â—ë –Ω–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
